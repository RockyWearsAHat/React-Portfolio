{"version":3,"file":"server.js","sources":["../../server/server.ts"],"sourcesContent":["import express, { Request, Response } from 'express';\nimport mailjet from 'node-mailjet';\nimport dotenv from 'dotenv';\nimport path from 'path';\nconsole.log(path.join(process.cwd(), '.env'));\ndotenv.config({\n  path: path.join(process.cwd(), '.env'),\n});\n\nimport serverless from 'serverless-http';\n\n//EXPORTING EXPRESS FUNCTION TO BE USED IN VITE CONFIG, THIS IS NECESSARY FOR THIS SETUP\nexport const app = express();\n\napp.use(express.json());\n\nconst port = 3000;\n\napp.post('/api/contact', async (req: Request, res: Response) => {\n  console.log(process.env.MAILJET_API, process.env.MAILJET_SECRET);\n\n  if (!process.env.MAILJET_API || !process.env.MAILJET_SECRET) {\n    return res.json({ ok: false, message: 'Message failed to send' });\n  }\n\n  const { name, email, message } = req.body;\n\n  const data = JSON.stringify({\n    Messages: [\n      {\n        From: { Email: 'alexwaldmann2004@gmail.com', Name: 'Alex' },\n        To: [{ Email: 'alexwaldmann2004@gmail.com', Name: 'Alex' }],\n        Subject: `Contact from ${name} @ ${email}`,\n        TextPart: `${email}\\n\\n${name} says:\\n${message}`,\n      },\n    ],\n  });\n\n  const mailRes = await mailjet\n    .apiConnect(process.env.MAILJET_API, process.env.MAILJET_SECRET)\n    .post('send', { version: 'v3.1' })\n    .request(data);\n\n  if (mailRes.response.status !== 200) {\n    return res.json({ ok: false, message: 'Message failed to send' });\n  }\n\n  return res.json({ ok: true, message: 'Message sent' });\n});\n\n//IF NOT VITE, HAVE EXPRESS SERVE STATIC FILES AND OPEN SERVER, VITE WILL OTHERWISE DO THIS\nif (!process.env['VITE'] && !process.env['NETLIFY']) {\n  const frontendFiles = process.cwd() + '/build/';\n  app.use(express.static(frontendFiles));\n  app.get('/*', (_req, res) => {\n    res.sendFile('index.html', { root: frontendFiles });\n  });\n  app.listen(process.env.PORT || 3000, () => {\n    console.log(\n      !process.env['PORT']\n        ? `Server started on http://localhost:${port}` //FOR DEV AND BUILD\n        : 'Server is running on host platform' //FOR HOSTING PLATFORM\n    );\n  });\n}\n\nexport const handler = serverless(app);\n"],"names":[],"mappings":"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"}